<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Virtue Catcher - Mythical Minds</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(to bottom, #87ceeb, #fefbd8);
      overflow-x: hidden;
    }

    #gameCanvas {
      display: block;
      margin: 20px auto;
      background: radial-gradient(circle at top, #fff, #d0f0c0);
      border: 5px solid #5d4037;
      box-shadow: 0 0 20px #a1887f;
      border-radius: 12px;
    }

    #scoreboard, #endScreen {
      text-align: center;
      font-size: 24px;
      font-weight: bold;
      color: #4e342e;
      background-color: #fff3e0;
      border: 2px solid #ffcc80;
      width: 280px;
      margin: 10px auto;
      padding: 10px;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }

    button {
      padding: 10px 20px;
      font-size: 16px;
      margin: 10px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      background-color: #81c784;
      color: white;
      transition: background 0.3s;
    }

    button:hover {
      background-color: #66bb6a;
    }

    #endScreen {
      display: none;
      background-color: #fffde7;
    }
  </style>
</head>
<body>

<canvas id="gameCanvas" width="400" height="600"></canvas>
<div id="scoreboard">‚ú® Score: <span id="score">0</span></div>

<div id="endScreen">
  <p>üéâ Game Over! Final Score: <span id="finalScore">0</span></p>
  <button onclick="restartGame()">üîÅ Restart</button>
  <button onclick="exitGame()">‚ùå Exit</button>
</div>

<script>
  const canvas = document.getElementById("gameCanvas");
  const ctx = canvas.getContext("2d");

  const basket = {
    x: 150,
    y: 560,
    width: 100,
    height: 25,
    moveLeft: false,
    moveRight: false
  };

  const virtues = [
    { text: "Truth ‚ú®", good: true },
    { text: "Kindness üíñ", good: true },
    { text: "Bravery üõ°Ô∏è", good: true }
  ];

  const vices = [
    { text: "Anger üî•", good: false },
    { text: "Greed üí∞", good: false },
    { text: "Jealousy üëø", good: false }
  ];

  let items = [];
  let score = 0;
  let totalDrops = 0;
  const maxDrops = 20;
  let gameRunning = true;

  function createItem() {
    if (!gameRunning) return;
    const isVirtue = Math.random() < 0.7;
    const pool = isVirtue ? virtues : vices;
    const selected = pool[Math.floor(Math.random() * pool.length)];
    items.push({
      x: Math.random() * 350,
      y: 0,
      ...selected,
      speed: 2 + Math.random() * 2
    });
    totalDrops++;
    if (totalDrops >= maxDrops) {
      clearInterval(dropInterval);
      setTimeout(() => {
        gameRunning = false;
      }, 1000); // allow last drop to process
    }
  }

  function drawBasket() {
    ctx.fillStyle = "#6d4c41";
    ctx.beginPath();
    ctx.roundRect(basket.x, basket.y, basket.width, basket.height, 10);
    ctx.fill();
    ctx.strokeStyle = "#4e342e";
    ctx.stroke();
  }

  function drawItems() {
    ctx.font = "18px Segoe UI";
    for (let item of items) {
      ctx.fillStyle = item.good ? "#2e7d32" : "#c62828";
      ctx.fillText(item.text, item.x, item.y);
      item.y += item.speed;
    }
  }

  function checkCatch() {
    for (let i = items.length - 1; i >= 0; i--) {
      const item = items[i];
      if (
        item.y + 18 >= basket.y &&
        item.x >= basket.x &&
        item.x <= basket.x + basket.width
      ) {
        score += item.good ? 10 : -5;
        document.getElementById("score").textContent = score;
        items.splice(i, 1);
      } else if (item.y > canvas.height) {
        items.splice(i, 1);
      }
    }
  }

  function updateBasket() {
    if (basket.moveLeft && basket.x > 0) basket.x -= 6;
    if (basket.moveRight && basket.x + basket.width < canvas.width) basket.x += 6;
  }

  function gameLoop() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    drawBasket();
    drawItems();
    updateBasket();
    checkCatch();

    if (!gameRunning && items.length === 0) {
      endGame();
      return;
    }

    requestAnimationFrame(gameLoop);
  }

  function endGame() {
    document.getElementById("finalScore").textContent = score;
    document.getElementById("endScreen").style.display = "block";
  }

  function restartGame() {
    score = 0;
    totalDrops = 0;
    items = [];
    gameRunning = true;
    document.getElementById("score").textContent = 0;
    document.getElementById("endScreen").style.display = "none";
    dropInterval = setInterval(createItem, 1000);
    gameLoop();
  }

  function exitGame() {
    alert("Thank you for playing Virtue Catcher! üåü");
    window.location.href = "DEMO.HTML"; // or any page you want
  }

  // Rounded rectangle
  CanvasRenderingContext2D.prototype.roundRect = function (x, y, width, height, radius) {
    this.beginPath();
    this.moveTo(x + radius, y);
    this.lineTo(x + width - radius, y);
    this.quadraticCurveTo(x + width, y, x + width, y + radius);
    this.lineTo(x + width, y + height - radius);
    this.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
    this.lineTo(x + radius, y + height);
    this.quadraticCurveTo(x, y + height, x, y + height - radius);
    this.lineTo(x, y + radius);
    this.quadraticCurveTo(x, y, x + radius, y);
    this.closePath();
  }

  // Keyboard controls
  document.addEventListener("keydown", (e) => {
    if (e.key === "ArrowLeft") basket.moveLeft = true;
    if (e.key === "ArrowRight") basket.moveRight = true;
  });
  document.addEventListener("keyup", (e) => {
    if (e.key === "ArrowLeft") basket.moveLeft = false;
    if (e.key === "ArrowRight") basket.moveRight = false;
  });

  // Start game
  let dropInterval = setInterval(createItem, 1000);
  gameLoop();
</script>
</body>
</html>
